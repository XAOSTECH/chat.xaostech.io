name = "xaostech-chat"
compatibility_date = "2025-12-31"
main = "dist/_worker.js/index.js"
send_metrics = false
compatibility_flags = ["nodejs_compat"]

[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[env.production]
name = "xaostech-chat"
main = "dist/_worker.js/index.js"
routes = [{ pattern = "chat.xaostech.io/*", zone_name = "xaostech.io" }]

[env.production.assets]
directory = "./dist"

# D1 Database for message persistence
[[env.production.d1_databases]]
binding = "DB"
database_name = "chat-db"
database_id = "${D1_CHAT_DB_ID}"

# KV for sessions (cross-subdomain auth)
[[env.production.kv_namespaces]]
binding = "SESSIONS_KV"
id = "${KV_SESSIONS_ID}"

# AI binding for LLM chat
[env.production.ai]
binding = "AI"

[env.production.vars]
ENABLE_WEBSOCKET = "true"

[env.testing.vars]
ENABLE_WEBSOCKET = "true"

